<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>åˆ†æ•¸å†’éšªå³¶ï¼šåˆ†æ•¸çš„è¨ˆç®—</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Zen Maru Gothic', sans-serif; background-color: #ecfeff; }
    .font-game { font-family: 'Fredoka', sans-serif; }
  </style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">

const { useState, useEffect } = React;

/* ===============================
   ç¬¬ 2 å–®å…ƒï½œå½±ç‰‡å­¸ç¿’è³‡æ–™
================================ */
const VIDEO_LESSONS_UNIT2 = [
  {
    title: "ã€æ¦‚å¿µã€‘æ•´æ•¸é™¤ä»¥ 2 èˆ‡ æ•´æ•¸ä¹˜ä»¥ 1/2",
    url: "https://www.youtube.com/embed/UPUmjWD898k",
    quiz: {
      q: "8 Ã— 1/2 çš„çµæœæ˜¯ï¼Ÿ",
      options: ["4", "8", "16", "1/4"],
      ans: "4"
    }
  },
  {
    title: "ã€ä¾‹é¡Œã€‘æ•´æ•¸ä¹˜ä»¥åˆ†æ•¸",
    url: "https://www.youtube.com/embed/mCkjP87aYQ0",
    quiz: {
      q: "5 Ã— 2/3 çš„æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼Ÿ",
      options: ["10/3", "7/3", "5/3", "10"],
      ans: "10/3"
    }
  },
  {
    title: "ã€ä¾‹é¡Œã€‘åˆ†æ•¸ä¹˜ä»¥åˆ†æ•¸ï¼ˆç”Ÿæ´»ä¾‹å­ï¼‰",
    url: "https://www.youtube.com/embed/rGWLf_LIm9E",
    quiz: {
      q: "1/2 çš„ 1/3 æ˜¯å¤šå°‘ï¼Ÿ",
      options: ["1/6", "1/5", "2/3", "1/2"],
      ans: "1/6"
    }
  }
];

/* ===============================
   å½±ç‰‡å­¸ç¿’ç«™å…ƒä»¶
================================ */
const VideoLearningStation = ({ videos, onLog }) => (
  <div className="mt-12 space-y-8">
    <h3 className="text-2xl font-bold text-blue-700 text-center">
      ğŸ¬ æ•´æ•¸èˆ‡åˆ†æ•¸ä¹˜æ³•é‹ç®—å½±ç‰‡å­¸ç¿’
    </h3>

    {videos.map((v, i) => (
      <div key={i} className="bg-white rounded-2xl p-4 shadow border">
        <h4 className="font-bold mb-2">{v.title}</h4>

        <iframe
          className="w-full aspect-video rounded-lg mb-4"
          src={v.url}
          allowFullScreen
          onLoad={() => onLog("video_view", v.title)}
        ></iframe>

        <p className="font-bold mb-2">ğŸ“ å°ç·´ç¿’ï¼š{v.quiz.q}</p>

        <div className="grid grid-cols-2 gap-2">
          {v.quiz.options.map((opt, idx) => (
            <button
              key={idx}
              className="bg-gray-100 hover:bg-blue-100 rounded-lg p-2"
              onClick={() =>
                onLog(
                  "video_quiz",
                  v.title,
                  v.quiz.q,
                  opt,
                  opt === v.quiz.ans
                )
              }
            >
              {opt}
            </button>
          ))}
        </div>
      </div>
    ))}
  </div>
);

/* ===============================
   ä¸»ç¨‹å¼
================================ */
function App() {
  const [name, setName] = useState("");
  const [started, setStarted] = useState(false);
  const [gasUrl, setGasUrl] = useState(
    localStorage.getItem("fractionAdventureGasUrl") ||
    "https://script.google.com/macros/s/AKfycbxr4w817Y7RjYRDFVKJtJiAdpLZTqWmSpJBHtP-GJqPaqnHj_PKczSkkYJZtM6JJ1E/exec"
  );

  const logLearning = async (type, videoTitle, q="", ans="", correct="") => {
    if (!gasUrl) return;

    const payload = {
      name,
      unit: "ç¬¬2å–®å…ƒ åˆ†æ•¸å†’éšªå³¶",
      type,
      video: videoTitle,
      question: q,
      answer: ans,
      correct,
      time: new Date().toLocaleString()
    };

    fetch(gasUrl, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
  };

  if (!started) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="bg-white p-8 rounded-2xl shadow-xl text-center w-80">
          <h1 className="text-3xl font-bold mb-4">ğŸï¸ åˆ†æ•¸å†’éšªå³¶</h1>
          <input
            className="border p-2 w-full mb-4 text-center"
            placeholder="è¼¸å…¥å†’éšªè€…å§“å"
            value={name}
            onChange={e => setName(e.target.value)}
          />
          <button
            className="bg-yellow-400 px-4 py-2 rounded-lg font-bold"
            onClick={() => setStarted(true)}
          >
            é–‹å§‹å­¸ç¿’
          </button>

          <input
            className="border p-1 text-xs mt-4 w-full"
            value={gasUrl}
            onChange={e => {
              setGasUrl(e.target.value);
              localStorage.setItem("fractionAdventureGasUrl", e.target.value);
            }}
          />
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen p-6 max-w-4xl mx-auto">
      <h2 className="text-3xl font-bold mb-6 text-center">
        ç¬¬ 2 å–®å…ƒï½œåˆ†æ•¸å†’éšªå³¶
      </h2>

      <VideoLearningStation
        videos={VIDEO_LESSONS_UNIT2}
        onLog={logLearning}
      />
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);

</script>
</body>
</html>
